<h1 id="redis" tabindex="-1">redis <a class="header-anchor" href="#redis" aria-label="Permalink to “redis”">&#8203;</a></h1>
<div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre><!--::markdown-it-async::ftmnncspd8swd9qmes5hx::--><code>1.docker
docker run -p 6379:6379 -it --rm redis/redis-stack-server:latest
2.手动编译
git clone --recursive https://github.com/RedisBloom/RedisBloom.git
cd RedisBloom
./sbin/setup
make
在redis配置文件中添加
loadmodule /path/to/redisbloom.so
然后启动
redis-server redis.conf</code></pre>
<div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h1 id="测试代码" tabindex="-1">测试代码 <a class="header-anchor" href="#测试代码" aria-label="Permalink to “测试代码”">&#8203;</a></h1>
<div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre><!--::markdown-it-async::yc1kmxq5pignszsn0hdm5::--><code>import os
from loguru import logger  # 日志相关
import redis


# -------------------------


def test_get_key():
    # 随机从26个字母中选择5个字母
    import random
    import string
    letters = string.ascii_lowercase
    random_letters = &#039;&#039;.join(random.choice(letters) for i in range(2))
    # logger.info(&quot;random_letters:{}&quot;.format(random_letters))
    return random_letters


# 获取ip
host = os.getenv(&#039;REDIS_URL&#039;, &#039;localhost&#039;)
# 获取端口
port = os.getenv(&#039;REDIS_PORT&#039;, 6379)
# 获取密码
password = os.getenv(&#039;REDIS_PASSWORD&#039;, &#039;&#039;)
# 获取db
db = os.getenv(&#039;REDIS_DB&#039;, 0)
# 创建布隆过滤器
filter_name = os.getenv(&#039;REDIS_FILTER_NAME&#039;, &#039;test_filter&#039;)
# 错误率
error_rate = os.getenv(&#039;REDIS_ERROR_RATE&#039;, 0.01)
# 预计插入的元素数量
capacity = os.getenv(&#039;REDIS_CAPACITY&#039;, 10000)

logger.info(f&quot;redis: {host}:{port}&quot;)
logger.info(f&quot;config:过滤器名字{filter_name}错误率{error_rate}预计数量{capacity}&quot;)
# 连接到 Redis
r = redis.Redis(host=host, port=port, password=password, db=db, decode_responses=True).bf()

try:
    r.reserve(filter_name, error_rate, capacity)
except Exception as e:
    logger.error(f&quot;过滤器已经存在:{e}&quot;)

# 随机添加100个
for i in range(100):
    r.add(filter_name, test_get_key())
# 随机生成100个看是否存在
for i in range(100):
    key = test_get_key()
    if r.exists(filter_name, key):
        logger.info(f&quot;key:{key}存在&quot;, key)
    else:
        logger.info(f&quot;key:{key}不存在&quot;, key)

# 批量生成100个
keys = [test_get_key() for i in range(100)]
# 批量添加
# r.madd(filter_name, *keys)
# 批量检查
print(r.mexists(filter_name, *keys))</code></pre>
<div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div>